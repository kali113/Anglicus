import{a as g,f as u}from"../chunks/P9lsyJN8.js";import{o as L}from"../chunks/BDunwwt_.js";import{Y as V,Z as b,_ as G,a0 as k,f as t,a1 as K,a2 as r,a5 as n,a3 as v,a6 as c}from"../chunks/DsCzRQW9.js";import{d as Y,e as Z,s as E}from"../chunks/C-_o5PLK.js";import{i as C}from"../chunks/rK5mkmgS.js";import{e as F,i as J}from"../chunks/BYJ2rnKm.js";import{r as N,s as Q}from"../chunks/b05JO4El.js";import{g as R,s as W}from"../chunks/zUqiq0NJ.js";import{b as X}from"../chunks/CkB6V6u5.js";import{b as ee}from"../chunks/LmzTHd12.js";import{b as T}from"../chunks/CAB4_IbL.js";import{g as te}from"../chunks/B8PVRu2a.js";import{C as se}from"../chunks/C6-Y0fCO.js";var ae=u('<div class="empty-state svelte-1q66yp3"><svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-1q66yp3"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" class="svelte-1q66yp3"></path></svg> <p class="svelte-1q66yp3">¡Hola! Soy tu tutor de inglés.</p> <p class="svelte-1q66yp3">Escribe algo para empezar a practicar.</p></div>'),re=u('<div><div class="message-bubble svelte-1q66yp3"> </div></div>'),oe=u('<div class="message assistant svelte-1q66yp3"><div class="message-bubble loading svelte-1q66yp3"><span class="dot svelte-1q66yp3"></span> <span class="dot svelte-1q66yp3"></span> <span class="dot svelte-1q66yp3"></span></div></div>'),ne=u('<div class="error-banner svelte-1q66yp3"> <a class="svelte-1q66yp3">Configuración</a></div>'),ie=u('<div class="tutor-page svelte-1q66yp3"><header class="header svelte-1q66yp3"><h1 class="svelte-1q66yp3">Tutor IA</h1> <p class="subtitle svelte-1q66yp3">Practica inglés conmigo</p></header> <div class="chat-container svelte-1q66yp3"><!> <!> <!></div> <form class="input-form svelte-1q66yp3"><!> <input type="text" placeholder="Escribe tu mensaje..." class="svelte-1q66yp3"/> <button type="submit" class="send-btn svelte-1q66yp3" aria-label="Send message"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1q66yp3"><line x1="22" y1="2" x2="11" y2="13" class="svelte-1q66yp3"></line><polygon points="22 2 15 22 11 13 11 2" class="svelte-1q66yp3"></polygon></svg></button></form></div>');function qe(j,B){V(B,!0);let _=R(),a=b(G([])),i=b(""),l=b(!1),y=b(""),d;L(()=>{if(!_){window.location.href=`${T}/onboarding`;return}I()});async function S(){if(!t(i).trim()||t(l)||!_)return;const e={id:crypto.randomUUID(),role:"user",content:t(i),timestamp:new Date().toISOString()};r(a,[...t(a),e],!0),r(i,""),r(l,!0),r(y,"");try{const p=[{role:"system",content:new se(_).generateSystemPrompt("General Conversation")},...t(a).slice(-10).map(P=>({role:P.role,content:P.content}))],h=await te(p,{maxTokens:300}),x={id:crypto.randomUUID(),role:"assistant",content:h.content,timestamp:new Date().toISOString()};r(a,[...t(a),x],!0)}catch{r(y,"Error de conexión. Ve a Configuración para elegir otra API o agregar tu propia clave."),r(a,[...t(a),{id:crypto.randomUUID(),role:"assistant",content:"Lo siento, hubo un error de conexión. ",timestamp:new Date().toISOString()}],!0)}finally{r(l,!1),I()}}function I(){setTimeout(()=>{d&&(d.scrollTop=d.scrollHeight)},50)}var q=ie(),f=n(v(q),2),M=v(f);{var H=e=>{var s=ae();g(e,s)};C(M,e=>{t(a).length===0&&e(H)})}var D=n(M,2);F(D,17,()=>t(a),J,(e,s)=>{var o=re();let p;var h=v(o),x=v(h,!0);c(h),c(o),k(()=>{p=W(o,1,"message svelte-1q66yp3",null,p,{user:t(s).role==="user"}),E(x,t(s).content)}),g(e,o)});var O=n(D,2);{var $=e=>{var s=oe();g(e,s)};C(O,e=>{t(l)&&e($)})}c(f),ee(f,e=>d=e,()=>d);var w=n(f,2),U=v(w);{var z=e=>{var s=ne(),o=v(s),p=n(o);c(s),k(()=>{E(o,`${t(y)??""} `),Q(p,"href",`${T}/settings`)}),g(e,s)};C(U,e=>{t(y)&&e(z)})}var m=n(U,2);N(m),m.__keydown=e=>e.key==="Enter"&&!e.shiftKey&&S();var A=n(m,2);c(w),c(q),k(e=>{m.disabled=t(l),A.disabled=e},[()=>!t(i).trim()||t(l)]),Z("submit",w,e=>{e.preventDefault(),S()}),X(m,()=>t(i),e=>r(i,e)),g(j,q),K()}Y(["keydown"]);export{qe as component};
